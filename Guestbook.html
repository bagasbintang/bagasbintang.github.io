<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>home</title>
  <link rel="stylesheet" href="dist/output.css">
  <script src="https://kit.fontawesome.com/47ba2857a3.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&amp;display=swap"
    rel="stylesheet">
</head>





<body id="body" class="bg-black text-white flex flex-col min-h-screen font-inter max-w-screen-lg mx-auto px-4 lg:px-0">

  <!-- NAVBAR -->
  <nav class="fixed top-0 inset-x-0 bg-transparent backdrop-blur-md shadow-2xl z-50 text-white">
      <div class="max-w-[950px] mx-auto px-5 lg:px-0 py-6">
        <div class="flex items-center justify-between relative mt-[10px]">
  
          <!-- LEFT ICON -->
          <a class="group flex items-center gap-2 text-slate-100 font-semibold tracking-tight hover:text-red-300" href="index.html">
            <i class="fa-solid fa-arrow-left fa-md transition-transform duration-300 group-hover:-translate-x-1"></i>
          </a>
  
          <!-- CENTER LOGO -->
          <i class="fa-solid fa-comments fa-xl absolute-left-1/2-translate-x-1/2" alt="Logo"></i>
  
          <!-- MENU -->
          <div class="hidden lg:flex space-x-6 font-light text-sm">
            <a href="about.html" class="hover:text-gray-300">About</a>
            <a href="about.html" class="hover:text-gray-300">Project</a>
            <a href="googleauth.html" class="hover:text-gray-300">GuestBook</a>
            <a href="#" class="hover:text-gray-300">More</a>
          </div>
        </div>
  
      </div>
    </nav>

    <!-- HERO -->
  <section class="pt-[190px] text-white">
      <div class="max-w-[900px] mx-auto px-5 lg:px-0">
        <div class="flex flex-col items-start lg:items-start">
          
            <h1 class="flex items-center gap-3 text-slate-100 text-[clamp(3rem,4.5vw,3.5rem)] leading-tight font-extrabold font-inter">
              <span class="tracking-tight">GuestBook</span>
            </h1>
            <span class="flex items-center gap-3 text-slate-400 text-xl leading-tight font-bold font-inter -mt-2 tracking-tight">
              Feel free to leave a short note or feedback
            </span>
          </div>
        </div>
      </div>
      </div>
    </section>


    <!-- COMMENT SECTION -->
<section class="max-w-[1000px] mx-auto px-5 lg:px-0 py-20 font-inter">

    <!-- COMMENTS LIST -->
    <div id="comments" class="space-y-0 mb-10 max-h-[60vh] lg:mx-auto lg:max-h-[950px] overflow-y-auto pr-4 w-full scroll-smooth bg-black"></div>
  
    <!-- LOGIN NOTICE -->
    <h1 class="text-lg font-semibold text-center text-gray-300 mb-4">
      Login required to comment
      <p class="text-sm font-semibold text-gray-500">Sign your info.. then i'll probably sell it to aliens, kidding :D"</p>
    </h1>
  
    <!-- LOGIN BUTTONS -->
    <div class="flex justify-center gap-4 mb-8">
      <button
        id="loginGoogle"
        class="flex items-center gap-2 bg-slate-200 text-black px-4 py-2 rounded-md text-sm font-medium hover:bg-white transition">
        Sign in with
        <i class="fa-brands fa-google text-black text-sm"></i>
      </button>
  
      <button
        id="loginGithub"
        class="flex items-center gap-2 bg-slate-200 text-black px-4 py-2 rounded-md text-sm font-medium hover:bg-white transition">
        Sign in with
        <i class="fa-brands fa-github text-black text-sm"></i>
      </button>
    </div>
  
    <!-- COMMENT FORM -->
    <div id="commentForm" class="space-y-3 hidden">
      <input
        id="name"
        class="w-full bg-transparent border border-gray-700 rounded-md px-3 py-2 text-sm text-gray-300 focus:outline-none focus:border-gray-500"
        placeholder="Name"
        disabled>
  
      <textarea
        id="message"
        rows="2"
        class="w-full bg-transparent border border-gray-700 rounded-md px-3 py-1 text-sm text-gray-300 focus:outline-none focus:border-gray-500 leading-snug resize-none result required
        " placeholder="Comment"
        disabled>
      </textarea>
  
      <button
        id="send"
        class="bg-slate-100 px-4 py-2 rounded-md text-sm font-semibold hover:bg-slate-500 transition disabled:opacity-40"
        disabled>
        <i class="fa-solid fa-paper-plane text-slate-900"></i>
        </button>

      <button id="logout" class="bg-slate-100 px-4 py-2  rounded-md text-sm text-slate-900 font-semibold hover:bg-slate-500 transition hidden">
        Logout
      <i class="fa-solid fa-right-from-bracket"></i>
      </button>
    </div>
  </section>



  <!-- FOOTER -->
  <footer class="mt-32 border-t border-gray-800">
      <div class="max-w-[900px] mx-auto px-5 lg:px-0 py-12">
  
        <div class="flex flex-col sm:flex-row gap-10 text-lg font-inter">
          <div>
            <a class="block text-gray-600 font-semibold hover:text-white" href="index.html">Home</a>
            <a class="block text-gray-600 font-semibold hover:text-white mt-2" href="#">Project</a>
          </div>
  
          <div>
            <a class="block text-gray-600 font-semibold hover:text-white" href="comment.html">GuestBook</a>
            <a class="block text-gray-600 font-semibold hover:text-white mt-2" href="about.html#contact">Contact</a>
          </div>
        </div>
  
        <div class="mt-8 text-sm">
          <button id="backToTop" class="flex items-center gap-2 text-gray-500 hover:text-white transition group">
            <i class="fa-solid fa-arrow-up text-xs transition-transform duration-300 group-hover:-translate-y-1"></i>
            Back to top
          </button>
        </div>
  
        <div class="mt-5 text-sm font-semibold text-gray-500">
          <span>©2024</span>
          <span class="mx-1">Bagas Bintang Kara</span>
          <span class="text-gray-400">• Bandung, Indonesia</span>
          <span id="online-dot" class="inline-block w-3 h-3 rounded-full bg-gray-700 ml-2 align-middle"></span>
        </div>
  
  
      </div>
    </footer>

</body>

  <script type="module">
    // FIREBASE CONFIG & IMPORT
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      onSnapshot,
      query,
      orderBy,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBbBQTF9vKHZW6cx5QCCsswyytPoC5bFKQ",
      authDomain: "bagas-site-comment.firebaseapp.com",
      projectId: "bagas-site-comment",
      storageBucket: "bagas-site-comment.firebasestorage.app",
      messagingSenderId: "183060203238",
      appId: "1:183060203238:web:e6dd527c6e2702353b1d27"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const commentsRef = collection(db, "comments");
    const commentsBox = document.getElementById("comments");
    const btn = document.getElementById("send");
    const logoutBtn = document.getElementById("logout");
    const loginBtn = document.getElementById("loginGoogle");
    const loginGithub = document.getElementById("loginGithub")
    const nameInput = document.getElementById("name");
    const messageInput = document.getElementById("message");

    let currentUser = null;

    const commentForm = document.getElementById("commentForm");

    // LOGIN GOOGLE
    loginBtn.addEventListener("click", async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        const user = result.user;

        currentUser = user;
        loginBtn.style.display ="none";
        loginGithub.style.display ="none";
        nameInput.value = user.displayName;
        nameInput.disabled = true;

        commentForm.classList.remove("hidden");
        messageInput.disabled = false;
        btn.disabled = false;
      } catch(err) {
        console.error(err);
      }
    });

    // CEK AUTH STATE
    onAuthStateChanged(auth, (user) => {
      if (user) {
        currentUser = user;
        loginBtn.style.display = "none";
        loginGithub.style.display ="none";
        nameInput.value = user.displayName;
        nameInput.disabled = true;
        commentForm.classList.remove("hidden");
        logoutBtn.classList.remove("hidden")
        messageInput.disabled = false;
        btn.disabled = false;
      } else {
        currentUser = null;
        loginBtn.style.display = "block";
        loginGithub.style.display = "block";
        commentForm.classList.add("hidden");
        logoutBtn.classList.add("hidden");
        nameInput.value = "";
        nameInput.disabled = true;
        messageInput.disabled = true;
        btn.disabled = true;
      }
    });

    //send 

  btn.addEventListener("click", async () => {
  const message = messageInput.value.trim();
  if (!currentUser || !message) return;

  await addDoc(commentsRef, {
    uid: currentUser.uid,
    name: currentUser.displayName,
    photo: currentUser.photoURL,
    message,
    createdAt: serverTimestamp()
  });

  messageInput.value = "";
});

  //logout
  logoutBtn.addEventListener("click",async() => {
    try{
      await signOut(auth);
    } catch (err) {
      console.error(err);
    }
  });




  
    // REALTIME KOMENTAR
    const q = query(commentsRef, orderBy("createdAt", "asc"));

    commentsBox.innerHTML = `
    <p class="text-sm text-gray-500 text-center">
      Loading comments..this was faster in my head
    </p>
    `;


    onSnapshot(q, (snapshot) => {
      commentsBox.innerHTML = "";
      snapshot.forEach((doc) => {
        const c = doc.data();

        let time = "";
        if (c.createdAt && window.innerWidth >= 1024) {
          const date = c.createdAt.toDate();
          time = date.toLocaleString("id-ID", {
            day: "2-digit",
            month: "short",
            year: "numeric",
            hour: "2-digit",
            minute: "2-digit"
          });
        }

        const isAuthor = currentUser && c.uid === currentUser.uid;
        //admin
        commentsBox.innerHTML += `
          <div class="border border-black rounded-lg hover:border-gray-800 p-4 flex gap-3 bg-black min-w-0 font-inter">
            <img src="${c.photo}" class="w-10 h-10 rounded-full object-cover">
            <div class="flex-1 max-w-[900px]">

              <div class="flex items-left gap-2">
  <strong>${c.name}</strong>
  ${isAuthor ?'<span class="text-[15px] px-1 py-0.5 text-indigo-500 font-semibold rounded-full">Contributor</span>':""}   
  ${time ? `<span class="text-[13px] py-0.5 text-gray-500">${time}</span>` : ""}
</div>
              <p class="inline-block text-sm max-w-[250px] lg:max-w-[100%] rounded-lg rounded-tl-none
               px-3 py-2.5 bg-gray-700 text-left break-words whitespace-pre-wrap leading-snug">${c.message}</p>
            </div>
          </div>
        `;;
      });
    });
  </script>
</html>